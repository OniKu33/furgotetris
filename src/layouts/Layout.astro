---
import "../styles/global.css";
import { ViewTransitions } from "astro:transitions";

const { title } = Astro.props;

// 1. OBTENER RUTA ACTUAL
const pathname = Astro.url.pathname.replace(/\/$/, "") || "/";

// 2. DETECTAR PÃGINAS ESPECIALES
const isTetrisMode =
	pathname.includes("/tetris") || pathname.includes("/carga");
const isLoginPage = pathname === "/login";

// 3. GESTIÃ“N DE ROLES
const userRole = Astro.cookies.get("furgorole")?.value || "invitado";
const isChunin = userRole === "chunin";

// 4. HELPER PARA ESTILOS
const getLinkClass = (path) => {
	const isActive =
		pathname === path || (path !== "/" && pathname.startsWith(path));
	return isActive
		? "text-yellow-400 bg-slate-700/50 shadow-inner scale-105"
		: "text-slate-400 hover:text-white hover:bg-slate-700/30";
};
---

<!doctype html>
<html lang="es">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
		/>
		<link rel="manifest" href="/manifest.json" />

		<ViewTransitions />

		<title>{title} | Agarrumberru</title>

		<meta
			name="description"
			content="GestiÃ³n de gira y carga de furgo. Tetris en tiempo real."
		/>
		<meta property="og:title" content="Agarrumberru - GestiÃ³n de Gira" />
		<meta
			property="og:description"
			content="Hojas de ruta, inventario y carga de camiÃ³n en tiempo real."
		/>
		<meta property="og:type" content="website" />
		<meta property="og:image" content="https://emojicdn.elk.sh/ðŸˆâ€" />
		<meta name="theme-color" content="#0f172a" />
		<ViewTransitions />
	</head>

	<body
		class="bg-slate-900 text-white min-h-screen font-sans overflow-x-hidden pb-32 selection:bg-yellow-500 selection:text-black"
	>
		<main class="max-w-md mx-auto min-h-screen relative">
			<slot />
		</main>

		{
			!isTetrisMode && !isLoginPage && (
				<div class="fixed bottom-6 left-0 right-0 z-50 flex justify-center px-4 pointer-events-none">
					<nav class="pointer-events-auto w-full max-w-sm bg-slate-800/90 backdrop-blur-xl border border-white/10 rounded-2xl shadow-2xl p-2 flex justify-around items-center gap-1 transition-all duration-300">
						{/* 1. DOCS (AHORA ES SOLO PARA CHUNIN) */}
						{/* El Genin ya estÃ¡ en Docs, no necesita botÃ³n, solo el cohete */}
						{isChunin && (
							<a
								href="/docs"
								class={`flex-1 flex flex-col items-center justify-center py-3 rounded-xl transition-all duration-200 ${getLinkClass("/docs")}`}
							>
								<span class="text-xl mb-1">ðŸ“„</span>
								<span class="text-[10px] font-bold uppercase tracking-wide">
									Docs
								</span>
							</a>
						)}

						{/* 2. ITEMS (Solo Chunin) */}
						{isChunin && (
							<a
								href="/inventario"
								class={`flex-1 flex flex-col items-center justify-center py-3 rounded-xl transition-all duration-200 ${getLinkClass("/inventario")}`}
							>
								<span class="text-xl mb-1">ðŸ“¦</span>
								<span class="text-[10px] font-bold uppercase tracking-wide">
									Items
								</span>
							</a>
						)}

						{/* 3. MANIFIESTO (Solo Chunin) */}
						{isChunin && (
							<a
								href="/manifiesto"
								class={`flex-1 flex flex-col items-center justify-center py-3 rounded-xl transition-all duration-200 ${getLinkClass("/manifiesto")}`}
							>
								<span class="text-xl mb-1">ðŸ“‹</span>
								<span class="text-[10px] font-bold uppercase tracking-wide">
									Manif.
								</span>
							</a>
						)}

						{/* 4. COHETE (PARA TODOS) */}
						{/* Si eres Genin, este serÃ¡ el Ãºnico botÃ³n y quedarÃ¡ centrado perfecto */}
						<a
							href="/tetris"
							class="flex items-center justify-center w-14 h-14 bg-gradient-to-br from-green-500 to-emerald-700 text-white rounded-xl shadow-lg border border-white/20 hover:scale-105 active:scale-95 transition-all duration-200 mx-1"
						>
							<span class="text-2xl filter drop-shadow-md">ðŸš€</span>
						</a>

						{/* EL CANDADO HA SIDO ELIMINADO DEFINITIVAMENTE */}
					</nav>
				</div>
			)
		}
	</body>
</html>
