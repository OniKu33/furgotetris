---
import "../styles/global.css";
import { ViewTransitions } from "astro:transitions";

const { title } = Astro.props;

// 1. OBTENER RUTA ACTUAL
// Truco: Quitamos la barra del final si existe para que '/login' y '/login/' sean lo mismo
const pathname = Astro.url.pathname.replace(/\/$/, "") || "/";

// 2. DETECTAR PÃGINAS ESPECIALES (Para ocultar el menÃº)
const isTetrisMode =
	pathname.includes("/tetris") || pathname.includes("/carga");
const isLoginPage = pathname === "/login";

// 3. GESTIÃ“N DE ROLES (Seguridad visual)
// Leemos la cookie. Si no existe, asumimos que es un invitado
const userRole = Astro.cookies.get("furgorole")?.value || "invitado";
const isChunin = userRole === "chunin"; // Solo el Chunin ve los botones de ediciÃ³n

// 4. HELPER PARA ESTILOS (BotÃ³n activo vs inactivo)
const getLinkClass = (path) => {
	// Si la ruta coincide exactamente O empieza por ella (para subsecciones)
	const isActive =
		pathname === path || (path !== "/" && pathname.startsWith(path));

	return isActive
		? "text-yellow-400 bg-slate-700/50 shadow-inner scale-105" // ACTIVO
		: "text-slate-400 hover:text-white hover:bg-slate-700/30"; // INACTIVO
};
---

<!doctype html>
<html lang="es">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
		/>
		<title>{title} | FurgoTetris</title>
		<ViewTransitions />
	</head>
	<body
		class="bg-slate-900 text-white min-h-screen font-sans overflow-x-hidden pb-32 selection:bg-yellow-500 selection:text-black"
	>
		<main class="max-w-md mx-auto min-h-screen relative">
			<slot />
		</main>

		{
			!isTetrisMode && !isLoginPage && (
				<div class="fixed bottom-6 left-0 right-0 z-50 flex justify-center px-4 pointer-events-none">
					<nav class="pointer-events-auto w-full max-w-sm bg-slate-800/90 backdrop-blur-xl border border-white/10 rounded-2xl shadow-2xl p-2 flex justify-around items-center gap-1 transition-all duration-300">
						<a
							href="/docs"
							class={`flex-1 flex flex-col items-center justify-center py-3 rounded-xl transition-all duration-200 ${getLinkClass("/docs")}`}
						>
							<span class="text-xl mb-1">ðŸ“„</span>
							<span class="text-[10px] font-bold uppercase tracking-wide">
								Docs
							</span>
						</a>

						{isChunin && (
							<a
								href="/inventario"
								class={`flex-1 flex flex-col items-center justify-center py-3 rounded-xl transition-all duration-200 ${getLinkClass("/inventario")}`}
							>
								<span class="text-xl mb-1">ðŸ“¦</span>
								<span class="text-[10px] font-bold uppercase tracking-wide">
									Items
								</span>
							</a>
						)}

						<a
							href="/tetris"
							class="flex items-center justify-center w-14 h-14 bg-gradient-to-br from-green-500 to-emerald-700 text-white rounded-xl shadow-lg border border-white/20 hover:scale-105 active:scale-95 transition-all duration-200 mx-1"
						>
							<span class="text-2xl filter drop-shadow-md">ðŸš€</span>
						</a>

						{isChunin && (
							<a
								href="/plan"
								class={`flex-1 flex flex-col items-center justify-center py-3 rounded-xl transition-all duration-200 ${getLinkClass("/plan")}`}
							>
								<span class="text-xl mb-1">ðŸ“‹</span>
								<span class="text-[10px] font-bold uppercase tracking-wide">
									Plan
								</span>
							</a>
						)}

						<a
							href="/login"
							onclick="document.cookie='furgorole=; Max-Age=0; path=/';"
							class="flex flex-col items-center justify-center px-3 py-3 rounded-xl text-slate-600 hover:text-red-400 transition-colors"
						>
							<span class="text-xl">ðŸ”’</span>
						</a>
					</nav>
				</div>
			)
		}
	</body>
</html>
